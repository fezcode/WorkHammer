<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:WorkHammer.ViewModels"
             xmlns:ui="clr-namespace:FluentAvalonia.UI.Controls;assembly=FluentAvalonia"
             xmlns:conv="using:WorkHammer.Views.Converters"
             x:Class="WorkHammer.Views.Controls.JobEditView"
             x:DataType="vm:MainWindowViewModel">

    <UserControl.Resources>
        <conv:StatusToColorConverter x:Key="StatusColorConverter"/>
        <conv:StatusToIconConverter x:Key="StatusIconConverter"/>
    </UserControl.Resources>

    <Grid RowSpan="2" RowDefinitions="Auto,*" IsVisible="{Binding IsEditing}">
        <Grid Grid.Row="0" ColumnDefinitions="*,Auto" Margin="0,0,0,40">
            <StackPanel Spacing="6"><StackPanel Orientation="Horizontal" Spacing="8"><TextBlock Text="Editing Application" FontSize="24" FontWeight="SemiBold" Foreground="White"/><TextBlock Text="*" FontSize="24" Foreground="{DynamicResource SystemControlBackgroundAccentBrush}" IsVisible="{Binding SelectedJob.IsDirty}" VerticalAlignment="Top"/><Border Background="{Binding SelectedJob.Status, Converter={StaticResource StatusColorConverter}}" CornerRadius="12" Padding="10,2" VerticalAlignment="Center" Margin="10,0,0,0"><StackPanel Orientation="Horizontal" Spacing="6"><ui:SymbolIcon Symbol="{Binding SelectedJob.Status, Converter={StaticResource StatusIconConverter}}" FontSize="12" Foreground="White" x:CompileBindings="False"/><TextBlock Text="{Binding SelectedJob.Status}" FontSize="10" Foreground="White" FontWeight="Bold"/></StackPanel></Border></StackPanel><TextBlock Text="{Binding SelectedJob.Company}" FontSize="14" Foreground="#AAAAAA"/></StackPanel>
            <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="12" VerticalAlignment="Top"><Button Command="{Binding SaveJobCommand}" Classes="accent" Content="Save Changes" Padding="20,8" /><Button Command="{Binding CancelEditCommand}" Content="Cancel" Padding="20,8" /></StackPanel>
        </Grid>
        <ScrollViewer Grid.Row="1" Padding="0,0,20,0">
            <StackPanel Spacing="32">
                <Grid ColumnDefinitions="*,30,*" RowDefinitions="Auto,Auto,Auto"><StackPanel Grid.Row="0" Grid.Column="0"><TextBlock Text="Company Name" Classes="section-header" Margin="0,0,0,10"/><TextBox Text="{Binding SelectedJob.Company}" Height="36" Foreground="White"/></StackPanel><StackPanel Grid.Row="0" Grid.Column="2"><TextBlock Text="Position Role" Classes="section-header" Margin="0,0,0,10"/><TextBox Text="{Binding SelectedJob.Role}" Height="36" Foreground="White"/></StackPanel><StackPanel Grid.Row="1" Grid.Column="0" Margin="0,25,0,0"><TextBlock Text="Status" Classes="section-header" Margin="0,0,0,10"/><ComboBox ItemsSource="{Binding JobStatuses}" SelectedItem="{Binding SelectedJob.Status}" HorizontalAlignment="Stretch" Height="36"><ComboBox.ItemTemplate><DataTemplate><TextBlock Text="{Binding}" Foreground="White"/></DataTemplate></ComboBox.ItemTemplate></ComboBox></StackPanel><StackPanel Grid.Row="1" Grid.Column="2" Margin="0,25,0,0"><TextBlock Text="Date Applied" Classes="section-header" Margin="0,0,0,10"/><CalendarDatePicker SelectedDate="{Binding SelectedJob.AppliedDate}" HorizontalAlignment="Stretch" Height="36" Foreground="White"/></StackPanel></Grid>
                
                <StackPanel><TextBlock Text="Job Link" Classes="section-header" Margin="0,0,0,10"/><TextBox Text="{Binding SelectedJob.Link}" Watermark="https://..." Height="36" Foreground="White"/></StackPanel>
                <StackPanel><TextBlock Text="Description" Classes="section-header" Margin="0,0,0,10"/><TextBox Text="{Binding SelectedJob.Description}" MinHeight="150" AcceptsReturn="True" TextWrapping="Wrap" VerticalContentAlignment="Top" FontFamily="Consolas, Monospace" Padding="12" Foreground="White"/></StackPanel>

                <StackPanel Spacing="12"><TextBlock Text="TECH STACK" Classes="section-header"/><ItemsControl ItemsSource="{Binding SelectedJob.TechStack}"><ItemsControl.ItemsPanel><ItemsPanelTemplate><WrapPanel/></ItemsPanelTemplate></ItemsControl.ItemsPanel><ItemsControl.ItemTemplate><DataTemplate><Border Classes="tech-badge"><StackPanel Orientation="Horizontal" Spacing="8"><TextBlock Text="{Binding}" FontSize="12" VerticalAlignment="Center"/><Button Classes="toolbar" Padding="2" Command="{Binding $parent[Window].((vm:MainWindowViewModel)DataContext).RemoveTechTagCommand}" CommandParameter="{Binding}"><PathIcon Data="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z" Width="8" Height="8" Foreground="White"/></Button></StackPanel></Border></DataTemplate></ItemsControl.ItemTemplate></ItemsControl><Grid ColumnDefinitions="*,Auto"><TextBox Text="{Binding NewTechTag}" Watermark="Add technology..." Height="36"><TextBox.KeyBindings><KeyBinding Gesture="Enter" Command="{Binding AddTechTagCommand}"/></TextBox.KeyBindings></TextBox><Button Grid.Column="1" Command="{Binding AddTechTagCommand}" Classes="accent" Content="Add" Height="36" Margin="8,0,0,0"/></Grid></StackPanel>
                
                <StackPanel Spacing="12">
                    <TextBlock Text="STAGES" Classes="section-header"/>
                    <ItemsControl ItemsSource="{Binding SelectedJob.Stages}">
                        <ItemsControl.ItemsPanel><ItemsPanelTemplate><StackPanel Spacing="4"/></ItemsPanelTemplate></ItemsControl.ItemsPanel>
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Border Background="#10FFFFFF" CornerRadius="4" Padding="10,6">
                                    <Grid ColumnDefinitions="*, Auto">
                                        <TextBlock Text="{Binding}" VerticalAlignment="Center"/>
                                        <Button Grid.Column="1" Classes="toolbar" Command="{Binding $parent[Window].((vm:MainWindowViewModel)DataContext).RemoveStageCommand}" CommandParameter="{Binding}">
                                            <ui:SymbolIcon Symbol="Dismiss" FontSize="16"/>
                                        </Button>
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                    <Grid ColumnDefinitions="*,Auto">
                        <TextBox Text="{Binding NewStageName}" Watermark="e.g. Technical Interview" Height="36">
                            <TextBox.KeyBindings><KeyBinding Gesture="Enter" Command="{Binding AddStageCommand}"/></TextBox.KeyBindings>
                        </TextBox>
                        <Button Grid.Column="1" Command="{Binding AddStageCommand}" Classes="accent" Content="Add Stage" Height="36" Margin="8,0,0,0"/>
                    </Grid>
                </StackPanel>

                <StackPanel Spacing="12">
                    <TextBlock Text="APPLICATION RESULT" Classes="section-header"/>
                    <Grid ColumnDefinitions="*, 20, *">
                        <StackPanel Grid.Column="0">
                            <TextBlock Text="Final Stage Reached" FontSize="11" Opacity="0.6" Margin="0,0,0,8"/>
                            <TextBox Text="{Binding SelectedJob.Result.Stage}" Height="36" Watermark="e.g. 3rd Stage"/>
                        </StackPanel>
                        <StackPanel Grid.Column="2">
                            <TextBlock Text="Reason / Feedback" FontSize="11" Opacity="0.6" Margin="0,0,0,8"/>
                            <TextBox Text="{Binding SelectedJob.Result.Reason}" Height="36" Watermark="e.g. Culture fit..."/>
                        </StackPanel>
                    </Grid>
                </StackPanel>

                <StackPanel Spacing="12">
                    <TextBlock Text="APPLICATION LOGS" Classes="section-header"/>
                    <ItemsControl ItemsSource="{Binding SelectedJob.Logs}">
                        <ItemsControl.ItemsPanel><ItemsPanelTemplate><StackPanel Spacing="8"/></ItemsPanelTemplate></ItemsControl.ItemsPanel>
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Border Background="#10FFFFFF" CornerRadius="6" Padding="10">
                                    <Grid ColumnDefinitions="Auto, *, Auto">
                                        <TextBlock Text="{Binding Date, StringFormat='{}{0:d}'}" FontSize="10" Opacity="0.5" VerticalAlignment="Center"/>
                                        <StackPanel Grid.Column="1" Margin="15,0">
                                            <TextBlock Text="{Binding Stage}" FontWeight="Bold" FontSize="11" Foreground="SkyBlue" IsVisible="{Binding Stage, Converter={x:Static StringConverters.IsNotNullOrEmpty}}"/>
                                            <TextBlock Text="{Binding Text}" FontSize="12" TextWrapping="Wrap"/>
                                        </StackPanel>
                                        <Button Grid.Column="2" Classes="toolbar" Command="{Binding $parent[Window].((vm:MainWindowViewModel)DataContext).RemoveLogCommand}" CommandParameter="{Binding}">
                                            <ui:SymbolIcon Symbol="Delete" FontSize="14" Foreground="#ff4d4d"/>
                                        </Button>
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                    <Border Background="#05FFFFFF" BorderBrush="#20FFFFFF" BorderThickness="1" CornerRadius="8" Padding="15">
                        <StackPanel Spacing="10">
                            <Grid ColumnDefinitions="*, 10, *">
                                <StackPanel Grid.Column="0">
                                    <TextBlock Text="Stage" FontSize="11" Opacity="0.6" Margin="0,0,0,5"/>
                                    <TextBox Text="{Binding NewLogStage}" Height="32" Watermark="e.g. Interview 1"/>
                                </StackPanel>
                                                                                <StackPanel Grid.Column="2">
                                                                                    <TextBlock Text="Date" FontSize="11" Opacity="0.6" Margin="0,0,0,5"/>
                                                                                    <CalendarDatePicker SelectedDate="{Binding NewLogDate}" HorizontalAlignment="Stretch" Height="32"/>
                                                                                </StackPanel>                            </Grid>
                                                                        <StackPanel>
                                                                            <TextBlock Text="Log Entry" FontSize="11" Opacity="0.6" Margin="0,0,0,5"/>
                                                                            <TextBox Text="{Binding NewLogText}" Watermark="What happened?" 
                                                                                     MinHeight="80" AcceptsReturn="True" TextWrapping="Wrap" 
                                                                                     VerticalContentAlignment="Top" Padding="8,5">
                                                                                <TextBox.KeyBindings><KeyBinding Gesture="Ctrl+Enter" Command="{Binding AddLogCommand}"/></TextBox.KeyBindings>
                                                                            </TextBox>
                                                                        </StackPanel>                            <Button Command="{Binding AddLogCommand}" Content="Add Log Entry" Classes="accent" HorizontalAlignment="Right"/>
                        </StackPanel>
                    </Border>
                </StackPanel>

                <StackPanel><TextBlock Text="Personal Notes" Classes="section-header" Margin="0,0,0,10"/><TextBox Text="{Binding SelectedJob.Notes}" MinHeight="120" AcceptsReturn="True" TextWrapping="Wrap" VerticalContentAlignment="Top" Padding="12" Foreground="White"/></StackPanel>
            </StackPanel>
        </ScrollViewer>
    </Grid>
</UserControl>
