<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:WorkHammer.ViewModels"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:ui="clr-namespace:FluentAvalonia.UI.Controls;assembly=FluentAvalonia"
        xmlns:conv="using:WorkHammer.Views.Converters"
        xmlns:models="using:WorkHammer.Models"
        xmlns:ctrl="using:WorkHammer.Views.Controls"
        mc:Ignorable="d" d:DesignWidth="1000" d:DesignHeight="600"
        x:Class="WorkHammer.Views.MainWindow"
        x:DataType="vm:MainWindowViewModel"
        Name="rootWindow"
        Icon="/Assets/wh-logo.ico"
        Title="WorkHammer"
        Width="{Binding WindowWidth, Mode=TwoWay}"
        Height="{Binding WindowHeight, Mode=TwoWay}"
        
        TransparencyLevelHint="{Binding IsTransparencyEnabled, Converter={x:Static conv:TransparencyConverter.Instance}}"
        Background="{Binding IsTransparencyEnabled, Converter={x:Static conv:TransparencyBackgroundConverter.Instance}}"
        ExtendClientAreaToDecorationsHint="True"
        ExtendClientAreaChromeHints="PreferSystemChrome"
        WindowStartupLocation="CenterScreen"
        FontFamily="Segoe UI Variable Display, Segoe UI, Inter, sans-serif">

    <Design.DataContext>
        <vm:MainWindowViewModel/>
    </Design.DataContext>

    <Window.Resources>
        <conv:StatusToColorConverter x:Key="StatusColorConverter"/>
        <conv:StatusToIconConverter x:Key="StatusIconConverter"/>
        <conv:StatusToPathConverter x:Key="StatusPathConverter"/>
        <conv:PathTruncateConverter x:Key="PathTruncateConverter"/>
        <conv:MathMultiplyConverter x:Key="MathMultiplyConverter"/>
    </Window.Resources>

    <Window.Styles>
        <!-- Custom Danger Button -->
        <Style Selector="Button.danger">
            <Setter Property="Background" Value="#40D13438"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderThickness" Value="0"/>
        </Style>
        <Style Selector="Button.danger:pointerover /template/ ContentPresenter">
            <Setter Property="Background" Value="#D13438"/>
            <Setter Property="Foreground" Value="White"/>
        </Style>

        <!-- Toolbar Button -->
        <Style Selector="Button.toolbar">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="6"/>
        </Style>
        <Style Selector="Button.toolbar:pointerover /template/ ContentPresenter">
            <Setter Property="Background" Value="#20FFFFFF"/>
        </Style>

        <!-- Sidebar List Item Style -->
        <Style Selector="ListBoxItem">
            <Setter Property="Padding" Value="0"/>
            <Setter Property="CornerRadius" Value="8"/>
            <Setter Property="Margin" Value="8,2"/>
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0"/>
        </Style>
        <Style Selector="ListBoxItem:pointerover /template/ ContentPresenter">
            <Setter Property="Background" Value="#15FFFFFF"/>
        </Style>
        <Style Selector="ListBoxItem:selected /template/ ContentPresenter">
            <Setter Property="Background" Value="#30FFFFFF"/>
            <Setter Property="Foreground" Value="White"/>
        </Style>

        <!-- Typography -->
        <Style Selector="TextBlock.section-header">
            <Setter Property="FontSize" Value="11"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="Opacity" Value="0.7"/>
            <Setter Property="Margin" Value="0,0,0,4"/>
        </Style>
        
        <Style Selector="TextBlock">
            <Setter Property="Foreground" Value="White"/>
        </Style>

        <Style Selector="Button.accent TextBlock">
            <Setter Property="Foreground" Value="Black"/>
        </Style>
        <Style Selector="Button.accent ui|SymbolIcon">
            <Setter Property="Foreground" Value="Black"/>
        </Style>
        <Style Selector="Button.accent PathIcon">
            <Setter Property="Foreground" Value="Black"/>
        </Style>

        <Style Selector="Label">
            <Setter Property="Foreground" Value="White"/>
        </Style>

        <!-- Menu / Flyout Styling -->
        <Style Selector="MenuFlyoutPresenter">
            <Setter Property="Background" Value="#202020"/>
            <Setter Property="BorderBrush" Value="#40FFFFFF"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="CornerRadius" Value="4"/>
            <Setter Property="Padding" Value="4"/>
            <Setter Property="FontFamily" Value="Segoe UI Variable Display, Segoe UI, Inter, sans-serif"/>
        </Style>

        <Style Selector="MenuItem">
            <Setter Property="CornerRadius" Value="4"/>
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="Padding" Value="0"/>
        </Style>
        <Style Selector="MenuItem /template/ ContentPresenter#PART_HeaderPresenter">
            <Setter Property="Padding" Value="10,8"/>
        </Style>
        <Style Selector="MenuItem:pointerover /template/ ContentPresenter#PART_HeaderPresenter">
            <Setter Property="Background" Value="#20FFFFFF"/>
        </Style>

        <!-- Status Bar Badge Style -->
        <Style Selector="Border.stat-badge">
            <Setter Property="Background" Value="#15FFFFFF"/>
            <Setter Property="CornerRadius" Value="4"/>
            <Setter Property="Padding" Value="8,2"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
        </Style>
        <Style Selector="Border.stat-badge TextBlock">
            <Setter Property="FontSize" Value="10"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Foreground" Value="Black"/>
        </Style>

        <!-- Tech Stack Badge -->
        <Style Selector="Border.tech-badge">
            <Setter Property="Background" Value="#20FFFFFF"/>
            <Setter Property="BorderBrush" Value="#40FFFFFF"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="CornerRadius" Value="12"/>
            <Setter Property="Padding" Value="10,4"/>
            <Setter Property="Margin" Value="0,0,8,8"/>
        </Style>
    </Window.Styles>

    <!-- Root Layout -->
    <Grid x:Name="MainRoot" RowDefinitions="Auto, *, Auto">
        
        <!-- Custom Title Bar -->
        <Grid Grid.Row="0" Height="40" Background="Transparent" PointerPressed="OnTitleBarPointerPressed" DoubleTapped="OnTitleBarDoubleTapped">
             <StackPanel x:Name="TitleBarContent" Orientation="Horizontal" VerticalAlignment="Center" HorizontalAlignment="Center" Spacing="10" IsHitTestVisible="False">
                 <PathIcon Data="M18,2H6C4.9,2 4,2.9 4,4v4h16V4C20,2.9 19.1,2 18,2M18,6H6V4h12V6M13,8v14h-2V8h2z" 
                           Width="14" Height="14" Foreground="#AAAAAA"/>
                 <TextBlock Text="WORKHAMMER" FontSize="12" FontWeight="SemiBold" VerticalAlignment="Center" 
                            Foreground="#AAAAAA"/>
             </StackPanel>
        </Grid>

        <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="260" MinWidth="200" MaxWidth="{Binding #rootWindow.Bounds.Width, Converter={StaticResource MathMultiplyConverter}, ConverterParameter=0.5}"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>
            
            <!-- SIDEBAR -->
            <ctrl:SidebarView Grid.Column="0" DataContext="{Binding}"/>

            <GridSplitter Grid.Column="1" Width="4" Background="Transparent" ResizeBehavior="PreviousAndNext"/>

            <!-- MAIN CONTENT -->
            <Panel Grid.Column="2">
                <Border Background="#20000000" IsHitTestVisible="False"/>
                
                <Grid IsVisible="{Binding SelectedJob, Converter={x:Static ObjectConverters.IsNotNull}}" Margin="40,30,40,40">
                    <ctrl:JobDetailView IsVisible="{Binding !IsEditing}" DataContext="{Binding}"/>
                    <ctrl:JobEditView IsVisible="{Binding IsEditing}" DataContext="{Binding}"/>
                </Grid>

                <!-- Empty State -->
                <Grid IsVisible="{Binding SelectedJob, Converter={x:Static ObjectConverters.IsNull}}" HorizontalAlignment="Center" VerticalAlignment="Center">
                    <StackPanel Spacing="20" HorizontalAlignment="Center">
                        <PathIcon Data="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z" Width="64" Height="64" Foreground="#40FFFFFF"/>
                        <StackPanel Spacing="5" HorizontalAlignment="Center">
                            <TextBlock Text="WorkHammer" FontSize="24" FontWeight="SemiLight" Opacity="0.5" HorizontalAlignment="Center"/>
                            <TextBlock Text="{Binding CurrentDataPath}" FontSize="12" Opacity="0.3" HorizontalAlignment="Center"/>
                        </StackPanel>
                    </StackPanel>
                </Grid>

                <!-- Settings Overlay -->
                <ctrl:SettingsOverlayView DataContext="{Binding}"/>
            </Panel>
        </Grid>

        <!-- Status Bar -->
        <ctrl:StatusBarView Grid.Row="2" DataContext="{Binding}"/>
    </Grid>
</Window>
